<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¼ˆê°ˆë‹¨ í†µí•© ëŒ€ì‹œë³´ë“œ</title>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; color: #333; margin: 0; }
        .banner { width: 100%; max-height: 300px; object-fit: cover; border-bottom: 3px solid #e74c3c; }
        .container { max-width: 1000px; margin: 20px auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid #eee; }
        
        /* íƒ­ ë©”ë‰´ */
        .tabs { display: flex; border-bottom: 2px solid #eee; margin-bottom: 20px; flex-wrap: wrap;}
        .tab-link { padding: 15px 10px; cursor: pointer; font-weight: bold; color: #999; transition: 0.3s; flex: 1; text-align: center; min-width: 80px; }
        .tab-link:hover { color: #e74c3c; background: #fff5f5; }
        .tab-link.active { color: #e74c3c; border-bottom: 4px solid #e74c3c; background: #fff; }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        h2 { color: #e74c3c; text-align: center; margin-top: 0; }
        .sub-title { color: #666; text-align: center; margin-bottom: 20px; }
        input.name-input { width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid #e74c3c; border-radius: 8px; background: #fff; color: #333; text-align: center; font-size: 1.1em; font-weight:bold; box-sizing: border-box; }
        textarea { width: 100%; height: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; resize: none; box-sizing: border-box; font-family: inherit; background: #fff; color: #333; margin-bottom: 10px; }
        textarea:focus { border-color: #e74c3c; outline: none; }
        .btn-submit { width: 100%; padding: 12px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 1em; transition: 0.3s; }
        .btn-submit:hover { background: #c0392b; }

        /* ë©¤ë²„ ê°¤ëŸ¬ë¦¬ ë° ì•„ë°”íƒ€ ì„¤ì • ìŠ¤íƒ€ì¼ */
        .member-form { background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #eee; display:flex; flex-direction: column; align-items: center; }
        
        /* ì•„ë°”íƒ€ ì»¤ìŠ¤í…€ ì˜ì—­ */
        .avatar-preview-container { display: flex; flex-direction: column; align-items: center; margin-bottom: 15px; }
        .avatar-preview { width: 100px; height: 100px; border-radius: 50%; border: 4px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); background: #eee; object-fit: cover; margin-bottom: 10px;}
        .avatar-controls { display: flex; gap: 10px; margin-bottom: 15px; }
        select.avatar-select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        button.avatar-btn { padding: 8px 12px; border: 1px solid #ccc; background: white; border-radius: 5px; cursor: pointer; }
        button.avatar-btn:hover { background: #eee; }

        .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .member-card { background: white; border: 1px solid #eee; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: 0.3s; position: relative; }
        .member-card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(231, 76, 60, 0.2); border-color: #e74c3c; }
        .member-avatar { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px; border: 3px solid #f0f0f0; object-fit: cover; background-color: #fff; }
        .member-name { font-weight: bold; font-size: 1.2em; color: #2c3e50; margin-bottom: 5px; }
        .member-bio { font-size: 0.9em; color: #666; word-break: keep-all; line-height: 1.5; }

        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ë“¤ */
        .day-headers { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-bottom: 10px; text-align: center; font-weight: bold; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .day-header.sun { color: #e74c3c; } .day-header.sat { color: #3498db; }
        .month-controls { display: flex; justify-content: center; align-items: center; margin-bottom: 20px; font-size: 1.3em; font-weight: bold; color: #333; }
        .btn-move { background: none; border: none; color: #e74c3c; font-size: 1.5em; cursor: pointer; padding: 0 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .day { height: 120px; border: 1px solid #e0e0e0; border-radius: 8px; padding: 8px; background: #fff; overflow-y: auto; cursor: pointer; transition: 0.2s; position: relative; }
        .day:hover { background-color: #ffeceb; border-color: #e74c3c; }
        .day.empty { background: none; border: none; cursor: default; }
        .day-number { font-weight: bold; margin-bottom: 5px; display: block; color: #333; }
        .day-sun .day-number { color: #e74c3c; } .day-sat .day-number { color: #3498db; }
        .submitter-tag { display: block; font-size: 11px; background: #2c3e50; color: #fff; padding: 3px 6px; margin-bottom: 3px; border-radius: 4px; }
        .my-submit { background: #e74c3c; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #fff; padding: 25px; border-radius: 12px; width: 500px; max-width: 90%; max-height: 85vh; display: flex; flex-direction: column; }
        .modal-header { color: #e74c3c; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; font-size: 1.2em; font-weight: bold; }
        .modal-body { overflow-y: auto; flex-grow: 1; padding-right: 5px; }
        .task-list { list-style: none; padding: 0; margin: 0 0 20px 0; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .task-item { background: #f9f9f9; padding: 12px; margin-bottom: 8px; border-radius: 6px; border-left: 4px solid #bdc3c7; }
        .task-author { font-weight: bold; color: #333; margin-bottom: 4px; font-size: 0.9em; }
        .ranking-list, .feed-list { list-style: none; padding: 0; }
        .ranking-item, .feed-item { background: #fff; padding: 15px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .ranking-item { display: flex; justify-content: space-between; align-items: center; }
        .rank { font-weight: bold; font-size: 1.2em; color: #e74c3c; margin-right: 15px; min-width: 40px; }
        .rank-name { flex-grow: 1; font-weight: bold; color: #333; }
        .rank-count { color: #666; font-size: 0.9em; background: #eee; padding: 5px 10px; border-radius: 20px; }
        .feed-header { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; }
        .feed-name { font-weight: bold; color: #2c3e50; font-size: 1.1em; }
        .feed-date { color: #999; font-size: 0.8em; }
        .feed-content { white-space: pre-wrap; margin-bottom: 20px; line-height: 1.6; }
        .comment-section { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .comment-item { background: #fff; padding: 8px 12px; margin-bottom: 5px; border-radius: 6px; font-size: 0.9em; border: 1px solid #eee; display:flex; gap: 10px; }
        .comment-author { color: #e74c3c; font-weight: bold; white-space: nowrap; }
        .loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); display:flex; justify-content:center; align-items:center; flex-direction: column; z-index: 2000; }
        .loading-spinner { border: 5px solid #f3f3f3; border-top: 5px solid #e74c3c; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .close-btn { cursor: pointer; font-size: 2em; line-height: 0.5; color: #999; }
    </style>
</head>
<body>

<img src="banner.jpg" alt="ë¼ˆê°ˆë‹¨ ë°°ë„ˆ" class="banner" onerror="this.style.display='none'">

<div id="loadingMsg" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div style="color:#e74c3c; font-weight:bold; font-size:1.2em;">ğŸ”¥ ë¼ˆê°ˆë‹¨ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<div class="container">
    <input type="text" id="userName" class="name-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (í•„ìˆ˜)">

    <div class="tabs">
        <div class="tab-link active" onclick="openTab('calendarTab', event)">ğŸ“… ì„±ê³¼ ë‹¬ë ¥</div>
        <div class="tab-link" onclick="openTab('rankingTab', event)">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</div>
        <div class="tab-link" onclick="openTab('snsTab', event)">ğŸ’€ ë¼ˆì´ìŠ¤ë¶</div>
        <div class="tab-link" onclick="openTab('memberTab', event)">ğŸ‘¥ ë©¤ë²„ ì†Œê°œ</div>
    </div>

    <div id="calendarTab" class="tab-content active">
        <h2>â˜ ï¸ ì›”ê°„ ì„±ê³¼ í˜„í™©</h2>
        <div class="sub-title">ì˜¤ëŠ˜ë„ ë¼ˆë¥¼ ê°ˆì•„ ë„£ì—ˆëŠ”ê°€?</div>
        <div class="month-controls">
            <button class="btn-move" onclick="changeMonth(-1)">â—€</button>
            <span id="currentMonth"></span>
            <button class="btn-move" onclick="changeMonth(1)">â–¶</button>
            <button onclick="loadData()" style="font-size:0.8em; cursor:pointer; background:none; border:none; color:#e74c3c;">ğŸ”„</button>
        </div>
        <div class="day-headers">
            <div class="day-header sun">ì¼</div> <div class="day-header">ì›”</div> <div class="day-header">í™”</div> <div class="day-header">ìˆ˜</div> <div class="day-header">ëª©</div> <div class="day-header">ê¸ˆ</div> <div class="day-header sat">í† </div>
        </div>
        <div class="calendar-grid" id="calendar"></div>
    </div>

    <div id="rankingTab" class="tab-content">
        <h2>ğŸ† ìµœë‹¤ ë¼ˆê°ˆì´ ë­í‚¹</h2>
        <div class="sub-title">ê°€ì¥ ë§ì´ ë¼ˆë¥¼ ê°„ ìëŠ” ëˆ„êµ¬ì¸ê°€?</div>
        <ul id="rankingList" class="ranking-list"></ul>
    </div>

    <div id="snsTab" class="tab-content">
        <h2>ğŸ’€ ë¼ˆì´ìŠ¤ë¶ í”¼ë“œ</h2>
        <div class="sub-title">ììœ ë¡œìš´ ì†Œí†µì˜ ê³µê°„</div>
        <div class="feed-form">
            <textarea id="inputFeed" placeholder="ë¬´ìŠ¨ ìƒê°ì„ í•˜ê³  ê³„ì‹ ê°€ìš”?"></textarea>
            <button class="btn-submit" onclick="saveFeed()">ê²Œì‹œí•˜ê¸°</button>
        </div>
        <ul id="feedList" class="feed-list"></ul>
    </div>

    <div id="memberTab" class="tab-content">
        <h2>ğŸ‘¥ ë¼ˆê°ˆë‹¨ ë©¤ë²„ë“¤</h2>
        <div class="sub-title">ìºë¦­í„°ë¥¼ ë§Œë“¤ì–´ ìì‹ ì„ í‘œí˜„í•˜ì„¸ìš”</div>
        
        <div class="member-form">
            <h4 style="margin-top:0;">ë‚´ ìºë¦­í„° ë§Œë“¤ê¸°</h4>
            
            <div class="avatar-preview-container">
                <img id="avatarPreview" src="" class="avatar-preview">
                <div class="avatar-controls">
                    <select id="avatarStyle" class="avatar-select" onchange="updateAvatarPreview()">
                        <option value="notionists">ë…¸ì…˜ ìŠ¤íƒ€ì¼ (ê¸°ë³¸)</option>
                        <option value="adventurer">ìš©ê°í•œ ëª¨í—˜ê°€</option>
                        <option value="bottts">ê·€ì—¬ìš´ ë¡œë´‡</option>
                        <option value="pixel-art">í”½ì…€ ì•„íŠ¸</option>
                        <option value="lorelei">ì˜ˆìˆ ì  ê°ì„±</option>
                        <option value="fun-emoji">ì´ëª¨ì§€</option>
                    </select>
                    <button class="avatar-btn" onclick="randomizeAvatar()">ğŸ² ì£¼ì‚¬ìœ„</button>
                </div>
            </div>

            <textarea id="inputBio" placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë§¤ì¼ 6ì‹œê°„ ê³µë¶€ ëª©í‘œ!)"></textarea>
            <button class="btn-submit" onclick="saveMember()">í”„ë¡œí•„ ì €ì¥í•˜ê¸°</button>
            <p style="font-size:0.8em; color:#999; margin-top:5px;">* ê°™ì€ ì´ë¦„ìœ¼ë¡œ ì €ì¥í•˜ë©´ ë‚´ìš©ì´ ìˆ˜ì •ë©ë‹ˆë‹¤.</p>
        </div>

        <div class="member-grid" id="memberList">
            </div>
    </div>
</div>

<div id="taskModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span id="modalDateTitle"></span>
            <span class="close-btn" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
            <h4 style="color:#e74c3c; margin-top:0;">ğŸ“‹ ë©¤ë²„ë“¤ì˜ ì¼ê³¼</h4>
            <ul id="taskList" class="task-list"></ul>
            <h4 style="color:#e74c3c;">âœï¸ ë‚˜ì˜ ì¼ê³¼ ê¸°ë¡</h4>
            <textarea id="inputTask" placeholder="ì˜¤ëŠ˜ ë¼ˆë¥¼ ê°ˆì•„ë„£ì€ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”..."></textarea>
            <button class="btn-submit" onclick="saveTask()">ë“±ë¡í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // âš ï¸ [ì¤‘ìš”] ìƒˆë¡œ ë°°í¬í•œ êµ¬ê¸€ ì›¹ ì•± URLì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”!
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwPzqObrlx0q5kXHHMPAKBTzq9J3XTd5j-LuPkxZKCWhNjiZ4pPEUbYMxFqLQxM3kvXpg/exec"; 
    // ============================================================

    let currentDate = new Date();
    let dbData = { tasks: [], feeds: [], comments: [], members: [] };
    let selectedDateKey = null;
    let currentAvatarSeed = ""; // í˜„ì¬ ì„ íƒëœ ì•„ë°”íƒ€ì˜ ëœë¤ ì‹œë“œ

    window.onload = function() {
        const savedName = localStorage.getItem('study_username');
        if(savedName) {
            document.getElementById('userName').value = savedName;
            currentAvatarSeed = savedName; // ê¸°ë³¸ ì‹œë“œëŠ” ì´ë¦„
        } else {
            currentAvatarSeed = "bone-squad";
        }
        updateAvatarPreview(); // ì•„ë°”íƒ€ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
        loadData();
    };

    document.getElementById('userName').addEventListener('input', function() {
        localStorage.setItem('study_username', this.value);
        // ì´ë¦„ ë°”ê¿€ ë•Œ, ì‚¬ìš©ìê°€ ëœë¤ ë²„íŠ¼ì„ ì•ˆ ëˆŒë €ë‹¤ë©´ ì´ë¦„ ë”°ë¼ê°€ê²Œ í•¨
        if(this.value) {
            currentAvatarSeed = this.value; 
            updateAvatarPreview();
        }
    });

    document.getElementById('userName').addEventListener('change', function() {
        renderCalendar();
    });

    // --- ì•„ë°”íƒ€ ê´€ë ¨ í•¨ìˆ˜ ---
    function updateAvatarPreview() {
        const style = document.getElementById('avatarStyle').value;
        const seed = currentAvatarSeed || "default";
        // DiceBear API URL ìƒì„±
        const url = `https://api.dicebear.com/7.x/${style}/svg?seed=${encodeURIComponent(seed)}`;
        document.getElementById('avatarPreview').src = url;
    }

    function randomizeAvatar() {
        // ëœë¤ ì‹œë“œ ìƒì„± (ìˆ«ì+ë¬¸ì ì¡°í•©)
        currentAvatarSeed = Math.random().toString(36).substring(7);
        updateAvatarPreview();
    }

    function loadData() {
        const loadingEl = document.getElementById('loadingMsg');
        if(SCRIPT_URL.includes("YOUR_NEW") || SCRIPT_URL === "") {
            loadingEl.style.display = 'none';
            alert("HTML íŒŒì¼ ë§¨ ì•„ë˜ SCRIPT_URLì„ ì„¤ì •í•´ì£¼ì„¸ìš”!");
            return;
        }
        loadingEl.style.display = 'flex';
        
        const safetyTimer = setTimeout(() => {
            if(loadingEl.style.display === 'flex') {
                loadingEl.style.display = 'none';
                alert("ì„œë²„ ì‘ë‹µ ì§€ì—°.");
            }
        }, 5000);

        fetch(SCRIPT_URL + "?action=getAllData")
            .then(response => response.json())
            .then(data => {
                clearTimeout(safetyTimer);
                dbData = data;
                try { 
                    renderCalendar(); 
                    renderRanking(); 
                    renderFeed(); 
                    renderMembers();
                } catch (e) { console.error(e); }
                loadingEl.style.display = 'none';
            })
            .catch(error => {
                clearTimeout(safetyTimer);
                console.error("í†µì‹  ì‹¤íŒ¨:", error);
                loadingEl.style.display = 'none';
            });
    }

    // --- ë Œë”ë§ í•¨ìˆ˜ë“¤ ---

    function renderCalendar() {
        const calendarEl = document.getElementById('calendar');
        calendarEl.innerHTML = '';
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        document.getElementById('currentMonth').innerText = `${year}ë…„ ${month + 1}ì›”`;
        const firstDayIndex = new Date(year, month, 1).getDay();
        const lastDay = new Date(year, month + 1, 0).getDate();
        const myName = document.getElementById('userName').value.trim();

        for (let i = 0; i < firstDayIndex; i++) {
            const emptyCell = document.createElement('div');
            emptyCell.className = 'day empty';
            calendarEl.appendChild(emptyCell);
        }

        for (let i = 1; i <= lastDay; i++) {
            const dateKey = `${year}-${month+1}-${i}`;
            const dayOfWeek = new Date(year, month, i).getDay();
            const dayEl = document.createElement('div');
            dayEl.className = 'day';
            if (dayOfWeek === 0) dayEl.classList.add('day-sun');
            if (dayOfWeek === 6) dayEl.classList.add('day-sat');
            dayEl.innerHTML = `<span class="day-number">${i}</span>`;

            if (dbData.tasks) {
                const todaysData = dbData.tasks.filter(item => item.date === dateKey);
                todaysData.forEach(item => {
                    const tag = document.createElement('span');
                    tag.className = 'submitter-tag';
                    tag.innerText = item.name;
                    if (myName && item.name === myName) tag.classList.add('my-submit');
                    dayEl.appendChild(tag);
                });
            }
            dayEl.onclick = () => openModal(dateKey);
            calendarEl.appendChild(dayEl);
        }
    }

    function renderRanking() {
        const listEl = document.getElementById('rankingList');
        listEl.innerHTML = '';
        if (!dbData.tasks || dbData.tasks.length === 0) { listEl.innerHTML = '<li style="text-align:center; padding:20px; color:#999;">ê¸°ë¡ ì—†ìŒ</li>'; return; }
        const counts = {};
        dbData.tasks.forEach(t => { counts[t.name] = (counts[t.name] || 0) + 1; });
        const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
        sorted.forEach((item, index) => {
            const li = document.createElement('li');
            li.className = 'ranking-item';
            let rankEmoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index+1}ìœ„`;
            li.innerHTML = `<span class="rank">${rankEmoji}</span><span class="rank-name">${item[0]}</span><span class="rank-count">${item[1]}íšŒ</span>`;
            listEl.appendChild(li);
        });
    }

    function renderFeed() {
        const listEl = document.getElementById('feedList');
        listEl.innerHTML = '';
        if (!dbData.feeds || dbData.feeds.length === 0) { listEl.innerHTML = '<li style="text-align:center; padding:20px; color:#999;">ì²« ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</li>'; return; }
        [...dbData.feeds].reverse().forEach(feed => {
            const li = document.createElement('li');
            li.className = 'feed-item';
            const myComments = dbData.comments ? dbData.comments.filter(c => c.feedId === feed.id) : [];
            let commentHtml = '';
            myComments.forEach(c => { commentHtml += `<li class="comment-item"><span class="comment-author">${c.name}</span><span class="comment-content">${c.content}</span></li>`; });
            const dateStr = new Date(feed.timestamp).toLocaleString();
            li.innerHTML = `<div class="feed-header"><span class="feed-name">${feed.name}</span><span class="feed-date">${dateStr}</span></div><div class="feed-content">${feed.content}</div><div class="comment-section"><ul class="comment-list" id="commentList-${feed.id}">${commentHtml}</ul><div style="display:flex; gap:5px;"><input type="text" id="commentInput-${feed.id}" placeholder="ëŒ“ê¸€..." style="flex:1; padding:8px; border:1px solid #ddd; border-radius:4px;"><button class="btn-submit" style="width:60px; padding:0;" onclick="saveComment('${feed.id}')">ë“±ë¡</button></div></div>`;
            listEl.appendChild(li);
        });
    }

    function renderMembers() {
        const listEl = document.getElementById('memberList');
        listEl.innerHTML = '';
        if (!dbData.members || dbData.members.length === 0) { listEl.innerHTML = '<p style="grid-column: 1/-1; text-align:center; color:#999;">ë“±ë¡ëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
        
        dbData.members.forEach(member => {
            const div = document.createElement('div');
            div.className = 'member-card';
            // DBì— ì €ì¥ëœ ì•„ë°”íƒ€ URL ì‚¬ìš© (ì—†ìœ¼ë©´ ì´ë¦„ ê¸°ë°˜ ê¸°ë³¸ê°’)
            const avatarUrl = member.avatar || `https://api.dicebear.com/7.x/notionists/svg?seed=${encodeURIComponent(member.name)}`;
            
            div.innerHTML = `
                <img src="${avatarUrl}" class="member-avatar" alt="${member.name}">
                <div class="member-name">${member.name}</div>
                <div class="member-bio">${member.bio}</div>
            `;
            listEl.appendChild(div);
        });
    }

    // --- ì €ì¥ í•¨ìˆ˜ë“¤ ---

    function saveTask() {
        const name = document.getElementById('userName').value.trim();
        const task = document.getElementById('inputTask').value.trim();
        if(!name || !task) { alert("ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        const newData = { action: 'saveTask', date: selectedDateKey, name: name, task: task };
        dbData.tasks.push(newData); renderCalendar(); renderRanking(); closeModal(); document.getElementById('inputTask').value = '';
        fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(newData) });
    }

    function saveFeed() {
        const name = document.getElementById('userName').value.trim();
        const content = document.getElementById('inputFeed').value.trim();
        if(!name || !content) { alert("ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        const newData = { action: 'saveFeed', id: 'feed_' + Date.now(), name: name, content: content, timestamp: new Date().toISOString() };
        if(!dbData.feeds) dbData.feeds = []; dbData.feeds.push(newData); renderFeed(); document.getElementById('inputFeed').value = '';
        fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(newData) });
    }

    function saveComment(feedId) {
        const name = document.getElementById('userName').value.trim();
        const inputEl = document.getElementById(`commentInput-${feedId}`);
        const content = inputEl.value.trim();
        if(!name || !content) { alert("ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        const newData = { action: 'saveComment', feedId: feedId, name: name, content: content, timestamp: new Date().toISOString() };
        if(!dbData.comments) dbData.comments = []; dbData.comments.push(newData); renderFeed();
        fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(newData) });
    }

    function saveMember() {
        const name = document.getElementById('userName').value.trim();
        const bio = document.getElementById('inputBio').value.trim();
        const avatarUrl = document.getElementById('avatarPreview').src; // í˜„ì¬ ë¯¸ë¦¬ë³´ê¸° ì¤‘ì¸ ì•„ë°”íƒ€ ì €ì¥

        if(!name || !bio) { alert("ì´ë¦„ê³¼ ì†Œê°œê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

        const newData = { action: 'saveMember', name: name, bio: bio, avatar: avatarUrl };
        
        if (!dbData.members) dbData.members = [];
        const existingIndex = dbData.members.findIndex(m => m.name === name);
        if (existingIndex >= 0) {
            dbData.members[existingIndex].bio = bio;
            dbData.members[existingIndex].avatar = avatarUrl;
            alert("í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
        } else {
            dbData.members.push(newData);
            alert("í™˜ì˜í•©ë‹ˆë‹¤! í”„ë¡œí•„ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
        
        renderMembers();
        document.getElementById('inputBio').value = '';
        fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(newData) });
    }

    // --- ìœ í‹¸ë¦¬í‹° ---
    function openTab(tabName, event) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-link').forEach(el => el.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tabName === 'rankingTab') renderRanking();
        if(tabName === 'snsTab') renderFeed();
        if(tabName === 'memberTab') renderMembers();
    }
    function openModal(date) {
        selectedDateKey = date;
        document.getElementById('modalDateTitle').innerText = date;
        const listEl = document.getElementById('taskList');
        listEl.innerHTML = '';
        const tasks = dbData.tasks ? dbData.tasks.filter(t => t.date === date) : [];
        if(tasks.length === 0) { listEl.innerHTML = '<li style="text-align:center; padding:20px; color:#999;">ê¸°ë¡ ì—†ìŒ</li>'; } 
        else { tasks.forEach(t => { listEl.innerHTML += `<li class="task-item"><div class="task-author">${t.name}</div><div class="task-desc">${t.task}</div></li>`; }); }
        document.getElementById('taskModal').style.display = 'flex';
    }
    function closeModal() { document.getElementById('taskModal').style.display = 'none'; }
    function changeMonth(step) { currentDate.setMonth(currentDate.getMonth() + step); renderCalendar(); }
    window.onclick = function(e) { if(e.target == document.getElementById('taskModal')) closeModal(); }
</script>
</body>
</html>
